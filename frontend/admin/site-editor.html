<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Super Admin | Site Editor | Mishra Industries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }
      .glass-effect {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
      }
    </style>
  </head>
   <body class="bg-slate-50 flex min-h-screen font-sans">
    <aside
      class="w-72 bg-slate-900 sticky top-0 h-screen text-white p-8 shadow-2xl flex flex-col"
    >
      <div class="flex items-center space-x-3 mb-12">
        <h2 class="text-2xl font-bold tracking-tighter">
          MISHRA <span class="text-orange-500">INDUSTRIES</span>
        </h2>
      </div>

      <nav class="space-y-2 flex-1">
        <a
          href="site-editor.html    "
          class="flex items-center space-x-3 p-3 hover:bg-orange-500/10 text-orange-500 rounded-xl font-bold transition"
        >
          <i></i> <span>Site Editor</span>
        </a>
        <a
          href="stock-dashboard.html"
          class="flex items-center space-x-3 p-3 hover:bg-orange-500/10 text-orange-500 rounded-xl font-bold transition"
        
        >
          <i></i> <span>Inventory</span>
        </a>
        <a
          href="users.html"
          class="flex items-center space-x-3 p-3 hover:bg-orange-500/10 text-orange-500 rounded-xl font-bold transition"
        >
        
          <i></i> <span>User Management</span>
        </a>
        <a
          href="orders.html"
          class="flex items-center space-x-3 p-3 hover:bg-orange-500/10 text-orange-500 rounded-xl font-bold transition"
        >
        
          <i></i> <span>Orders</span>
        </a>
      </nav>

      <a
        href="../index.html"
        class="flex items-center space-x-3 p-3 text-slate-500 hover:text-red-400 transition border-t border-slate-800"
      >
        <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
      </a>
    </aside>

    <main class="flex-1 p-12 overflow-y-auto custom-scrollbar">
      <div class="flex justify-between items-end mb-12">
        <div>
  <h1 class="text-4xl font-black text-slate-800 mb-2">Product Manager</h1>
  <p class="text-slate-500 font-medium">Manage your digital showroom and product pricing.</p>
</div>
<div class="flex-1 max-w-md mx-8">
  <div class="relative group">
    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-orange-500 transition-colors"></i>
    <input 
      type="text" 
      id="tableSearch" 
      placeholder="Search name, category or brand..." 
      oninput="loadProducts()"
      class="w-full bg-white border border-slate-200 pl-12 pr-4 py-3 rounded-2xl outline-none focus:border-orange-500 shadow-sm transition-all"
    />
  </div>
</div>
        <button
          onclick="toggleModal()"
          class="bg-slate-900 hover:bg-orange-600 text-white px-8 py-4 rounded-2xl font-bold shadow-xl transition-all transform hover:-translate-y-1 flex items-center space-x-3"
        >
          <i class="fas fa-plus"></i> <span>Add New Product</span>
        </button>
      </div>

      <div
        class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden"
      >
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="bg-slate-50/50 border-b border-slate-100">
              <th
                class="p-6 text-xs font-black text-slate-400 uppercase tracking-widest"
              >
                Product
              </th>
              <th
                class="p-6 text-xs font-black text-slate-400 uppercase tracking-widest"
              >
                Category
              </th>
              <th
                class="p-6 text-xs font-black text-slate-400 uppercase tracking-widest"
              >
                Brand
              </th>
              <th
                class="p-6 text-xs font-black text-slate-400 uppercase tracking-widest"
              >
                Pricing
              </th>
              <th
                class="p-6 text-xs font-black text-slate-400 uppercase tracking-widest"
              >
                Discount
              </th>
              <th
                class="p-6 text-xs font-black text-slate-400 uppercase tracking-widest text-right"
              >
                Actions
              </th>
            </tr>
          </thead>
          <tbody id="productTableBody" class="divide-y divide-slate-50"></tbody>
        </table>
      </div>
    </main>

    <div
      id="productModal"
      class="fixed inset-0 bg-slate-900/60 hidden items-center justify-center z-[100] backdrop-blur-md transition-all"
    >
      <div
        class="bg-white w-full max-w-md rounded-3xl shadow-2xl p-6 animate__animated animate__zoomIn animate__faster"
      >
        <div class="flex justify-between items-center mb-8">
          <h2
            id="modalTitle"
            class="text-3xl font-black text-slate-800 tracking-tight"
          >
            Add Product
          </h2>
          <button
            onclick="toggleModal()"
            class="text-slate-400 hover:text-red-500 transition text-2xl"
          >
            &times;
          </button>
        </div>

        <form id="productForm" class="space-y-4">
          <div class="relative group">
            <label class="block text-sm font-bold text-slate-700 mb-2"
              >Product Image</label
            >
            <div
              id="imagePreviewContainer"
              class="hidden mb-4 relative h-32 w-full rounded-2xl overflow-hidden border"
            >
              <img
                id="imagePreview"
                src=""
                class="w-full h-full object-contain"
              />
              <button
                type="button"
                onclick="resetImage()"
                class="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full shadow-lg"
              >
                <i class="fas fa-times"></i>
              </button>
            </div>
            <label
              id="uploadLabel"
              class="flex flex-col items-center justify-center w-full h-32 border-2 border-slate-200 border-dashed rounded-3xl cursor-pointer bg-slate-50 hover:bg-slate-100 transition"
            >
              <div class="flex flex-col items-center justify-center pt-5 pb-6">
                <i class="fas fa-image text-slate-400 text-3xl mb-3"></i>
                <p class="text-sm font-bold text-slate-500">
                  Drop image here or click
                </p>
              </div>
              <input
                type="file"
                id="prodImage"
                class="hidden"
                accept="image/*"
                onchange="previewFile()"
              />
            </label>
          </div>

          <div class="grid grid-cols-2 gap-6">
            <div class="col-span-2">
              <label class="block text-sm font-bold text-slate-700 mb-2"
                >Title</label
              >
              <input
                type="text"
                id="prodName"
                placeholder="e.g. 10A Toggle Switch"
                class="w-full bg-slate-50 border border-slate-200 p-3 rounded-xl outline-none focus:border-orange-500 focus:bg-white transition"
              />
            </div>
            <div>
              <label class="block text-sm font-bold text-slate-700 mb-2"
                >Price (₹)</label
              >
              <input
                type="number"
                id="prodPrice"
                placeholder="0.00"
                class="w-full bg-slate-50 border border-slate-200 p-3 rounded-xl outline-none focus:border-orange-500 focus:bg-white transition"
              />
            </div>
            <div>
              <label class="block text-sm font-bold text-slate-700 mb-2"
                >Discount (%)</label
              >
              <input
                type="number"
                id="prodDiscount"
                value="0"
                class="w-full bg-slate-50 border border-slate-200 p-3 rounded-xl outline-none focus:border-orange-500 focus:bg-white transition"
              />
            </div>
            <div class="grid grid-cols-2 gap-4 col-span-2">
              <div>
                <label class="block text-sm font-bold text-slate-700 mb-2"
                  >Category</label
                >
                <select
                  id="prodCategory"
                  class="w-full bg-slate-50 border border-slate-200 p-3 rounded-xl outline-none focus:border-orange-500 focus:bg-white transition"
                >
                  <option>Switches</option>
                  <option>Cables</option>
                  <option>Lightining</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-bold text-slate-700 mb-2"
                  >Company</label
                >
                <select
                  id="prodCompany"
                  class="w-full bg-slate-50 border border-slate-200 p-3 rounded-xl outline-none focus:border-orange-500 focus:bg-white transition"
                >
                  <option value="">Select Brand</option>
                  <option>Siemens</option>
                  <option>Anchor</option>
                  <option>Havells</option>
                  <option>Polycab</option>
                  <option>L&T</option>
                  <option>Mishra Atlas</option>
                </select>
              </div>
            </div>
            <div class="col-span-2">
              <label class="block text-sm font-bold text-slate-700 mb-2"
                >Description</label
              >
              <textarea
                id="prodDesc"
                placeholder="Technical specifications..."
                class="w-full bg-slate-50 border border-slate-200 p-3 rounded-xl h-24 outline-none focus:border-orange-500 focus:bg-white transition"
              ></textarea>
            </div>
          </div>

          <button
            type="button"
            onclick="handleProductForm()"
            class="w-full bg-orange-500 text-white py-5 rounded-2xl font-black uppercase tracking-widest hover:bg-slate-900 shadow-xl transition-all"
          >
            Save Product & Sync
          </button>
        </form>
      </div>
    </div>
    <script module>
      const API_URL ="https://mishra-industries-ltd-yjfr.onrender.com/api/products";
      let isEditing = false;
      let currentEditId = null;

      function toggleModal() {
        const modal = document.getElementById("productModal");
        modal.classList.toggle("hidden");
        modal.classList.toggle("flex");
        if (modal.classList.contains("hidden")) resetForm();
      }

      function previewFile() {
        const preview = document.getElementById("imagePreview");
        const file = document.getElementById("prodImage").files[0];
        const reader = new FileReader();

        reader.onloadend = function () {
          preview.src = reader.result;
          document
            .getElementById("imagePreviewContainer")
            .classList.remove("hidden");
          document.getElementById("uploadLabel").classList.add("hidden");
        };

        if (file) reader.readAsDataURL(file);
      }

      function resetImage() {
        document.getElementById("prodImage").value = "";
        document
          .getElementById("imagePreviewContainer")
          .classList.add("hidden");
        document.getElementById("uploadLabel").classList.remove("hidden");
      }

      function resetForm() {
        document.getElementById("productForm").reset();
        resetImage();
        isEditing = false;
        currentEditId = null;
        document.getElementById("modalTitle").innerText = "Add New Product";
        document.getElementById("prodCompany").value = "";
      }

      async function handleProductForm() {
        const formData = new FormData();
        formData.append("name", document.getElementById("prodName").value);
        formData.append("price", document.getElementById("prodPrice").value);
        formData.append(
          "discount",
          document.getElementById("prodDiscount").value,
        );
        formData.append(
          "category",
          document.getElementById("prodCategory").value,
        );
        formData.append(
          "company",
          document.getElementById("prodCompany").value,
        );
        formData.append(
          "description",
          document.getElementById("prodDesc").value,
        );

        const imageFile = document.getElementById("prodImage").files[0];
        if (imageFile) formData.append("image", imageFile);

        if (
          !document.getElementById("prodName").value ||
          !document.getElementById("prodPrice").value
        ) {
          return alert("Product Name and Price are mandatory.");
        }

        try {
          const url =
            isEditing ? `${API_URL}/edit/${currentEditId}` : `${API_URL}/add`;
          const method = isEditing ? "PUT" : "POST";

          const response = await fetch(url, { method, body: formData });

          if (response.ok) {
            alert(
              isEditing ? "Product Updated!" : (
                "Product Published Successfully!"
              ),
            );
            location.reload();
          }
        } catch (err) {
          console.error("Operation failed", err);
          alert("Could not sync with database. Is the server running?");
        }
      }

      async function loadProducts() {
  try {
    const response = await fetch(`${API_URL}/all`);
    const products = await response.json();
    const tableBody = document.getElementById("productTableBody");
    const searchTerm = document.getElementById("tableSearch").value.toLowerCase(); // Get search term
    
    tableBody.innerHTML = "";

    // Filter products based on search
    const filteredProducts = products.filter(product => 
      product.name.toLowerCase().includes(searchTerm) || 
      product.category.toLowerCase().includes(searchTerm) || 
      (product.company && product.company.toLowerCase().includes(searchTerm))
    );

    if (filteredProducts.length === 0) {
      tableBody.innerHTML = `<tr><td colspan="6" class="p-12 text-center text-slate-400">No products match your search.</td></tr>`;
      return;
    }

    filteredProducts.forEach((product) => {
      tableBody.innerHTML += `
        <tr class="group hover:bg-slate-50 transition">
            <td class="p-6">
                <div class="flex items-center space-x-4">
                    <img src="https://mishra-industries-ltd-yjfr.onrender.com${product.image}" onerror="this.src='../images/logo.jpeg'" class="w-14 h-14 object-cover rounded-xl border border-slate-100 shadow-sm">
                    <span class="font-bold text-slate-700">${product.name}</span>
                </div>
            </td>
            <td class="p-6 text-slate-500 font-medium">${product.category}</td>
            <td class="p-6 text-slate-500 font-medium">${product.company || "Unknown"}</td>
            <td class="p-6 font-black text-slate-800">₹${product.price.toLocaleString()}</td>
            <td class="p-6">
                <span class="bg-orange-100 text-orange-600 text-[10px] font-black px-3 py-1 rounded-full">
                    ${product.discount}% OFF
                </span>
            </td>
            <td class="p-6 text-right space-x-2">
                <button onclick="prepareEdit('${product._id}')" class="p-3 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition">
                    <i class="fas fa-edit"></i>
                </button>
                <button onclick="deleteProduct('${product._id}')" class="p-3 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-xl transition">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>`;
    });
  } catch (err) {
    console.error("Fetch failed", err);
  }
}

      async function prepareEdit(id) {
        try {
          const response = await fetch(`${API_URL}/${id}`);
          const product = await response.json();

          if (product) {
            isEditing = true;
            currentEditId = id;
            document.getElementById("modalTitle").innerText = "Edit Product";
            document.getElementById("prodName").value = product.name;
            document.getElementById("prodPrice").value = product.price;
            document.getElementById("prodDiscount").value =
              product.discount || 0;
            document.getElementById("prodCategory").value = product.category;
            document.getElementById("prodCompany").value =
              product.company || "";
            document.getElementById("prodDesc").value = product.description;

            document.getElementById("imagePreview").src =
              `https://mishra-industries-ltd-yjfr.onrender.com${product.image}`;
            document
              .getElementById("imagePreviewContainer")
              .classList.remove("hidden");
            document.getElementById("uploadLabel").classList.add("hidden");

            toggleModal();
          }
        } catch (err) {
          console.error(err);
        }
      }

      async function deleteProduct(id) {
        if (confirm("Permanently delete this product from database?")) {
          try {
            const response = await fetch(`${API_URL}/delete/${id}`, {
              method: "DELETE",
            });
            if (response.ok) {
              alert("Product Deleted Successfully");
              location.reload();
            }
          } catch (err) {
            console.error(err);
          }
        }
      }

      document.addEventListener("DOMContentLoaded", loadProducts);
    </script>
  </body>
</html>
