<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin | Order Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body class="bg-slate-50 flex min-h-screen font-sans">
    <aside
      class="w-72 bg-slate-900 sticky top-0 h-screen text-white p-8 shadow-2xl flex flex-col"
    >
      <div class="flex items-center space-x-3 mb-12">
        <h2 class="text-2xl font-bold tracking-tighter">
          MISHRA <span class="text-orange-500">INDUSTRIES</span>
        </h2>
      </div>

      <nav ">
        <a
          href="site-editor.html"
          class="flex items-center space-x-3 p-3 hover:bg-orange-500/10 text-orange-500 rounded-xl font-bold transition"
        >
          <i></i> <span>Site Editor</span>
        </a>
        <a
          href="stock-dashboard.html"
          class="flex items-center space-x-3 p-3 hover:bg-orange-500/10 text-orange-500 rounded-xl font-bold transition"
        >
          <i></i> <span>Inventory</span>
        </a>
        <a
          href="users.html"
          class="flex items-center space-x-3 p-3 hover:bg-orange-500/10 text-orange-500 rounded-xl font-bold transition"
        >
        
          <i></i> <span>User Management</span>
        </a>
        <a
          href="orders.html"
          class="flex items-center space-x-3 p-3 hover:bg-orange-500/10 text-orange-500 rounded-xl font-bold transition"
        >
        
          <i></i> <span>Orders</span>
        </a>
      </nav>

      <a
        href="../index.html"
        class="flex items-center space-x-3 p-3 text-slate-500 hover:text-red-400 transition border-t border-slate-800"
      >
        <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
      </a>
    </aside>

    <main class="flex-1 p-12">
      <h1 class="text-3xl font-black text-slate-800 mb-8">Customer Orders</h1>

      <div
        class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden"
      >
        <table class="w-full text-left">
          <thead class="bg-slate-50 border-b">
            <tr>
              <th class="p-6 text-[10px] font-black text-slate-400 uppercase">
                Customer
              </th>
              <th class="p-6 text-[10px] font-black text-slate-400 uppercase">
                Items
              </th>
              <th class="p-6 text-[10px] font-black text-slate-400 uppercase">
                Total
              </th>
              <th class="p-6 text-[10px] font-black text-slate-400 uppercase">
                Status
              </th>
              <th
                class="p-6 text-[10px] font-black text-slate-400 uppercase text-right"
              >
                Action
              </th>
            </tr>
          </thead>
          <tbody id="orderTableBody" class="divide-y divide-slate-50"></tbody>
        </table>
      </div>
    </main>

    <script>
      async function loadOrders() {
        try {
          const response = await fetch(
            "https://mishra-industries-ltd-yjfr.onrender.com/api/orders/all",
          );
          const orders = await response.json();
          const table = document.getElementById("orderTableBody");
          table.innerHTML = "";

          orders.forEach((order) => {
            const statusColor =
              order.status === "Pending" ?
                "bg-orange-100 text-orange-600"
              : "bg-green-100 text-green-600";

            table.innerHTML += `
                        <tr class="hover:bg-slate-50 transition">
                            <td class="p-6">
                                <p class="font-bold text-slate-800">${order.customerName}</p>
                                <p class="text-[10px] text-slate-400">${order.phone}</p>
                            </td>
                            <td class="p-6 text-sm text-slate-500">
                                ${order.items.map((i) => `${i.name} (x1)`).join(", ")}
                            </td>
                            <td class="p-6 font-black text-blue-900">â‚¹${order.totalAmount.toLocaleString()}</td>
                            <td class="p-6">
                                <span class="${statusColor} text-[10px] font-black px-3 py-1 rounded-full uppercase">${order.status}</span>
                            </td>
                            <td class="p-6 text-right">
                                <button onclick="updateStatus('${order._id}', 'Shipped')" class="text-blue-600 hover:underline text-xs font-bold">Mark Shipped</button>
                            </td>
                        </tr>`;
          });
        } catch (err) {
          console.error(err);
        }
      }

      async function updateStatus(id, newStatus) {
        await fetch(
          `https://mishra-industries-ltd-yjfr.onrender.com/api/orders/status/${id}`,
          {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ status: newStatus }),
          },
        );
        loadOrders();
      }

      document.addEventListener("DOMContentLoaded", loadOrders);
    </script>
  </body>
</html>
