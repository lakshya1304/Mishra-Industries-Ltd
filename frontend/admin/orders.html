<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin | Order Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-50 flex">

    <aside class="w-72 bg-slate-900 h-screen sticky top-0 text-white p-8 shadow-2xl">
        <h2 class="text-2xl font-bold mb-10 tracking-tighter">MISHRA <span class="text-orange-500">PRO</span></h2>
        <nav class="space-y-2">
            <a href="site-editor.html" class="block p-4 hover:bg-slate-800 rounded-xl transition text-slate-400"><i class="fas fa-layer-group mr-3"></i> Site Editor</a>
            <a href="#" class="block p-4 bg-orange-500/10 text-orange-500 rounded-xl font-bold transition"><i class="fas fa-shopping-bag mr-3"></i> Orders</a>
        </nav>
    </aside>

    <main class="flex-1 p-12">
        <h1 class="text-3xl font-black text-slate-800 mb-8">Customer Orders</h1>
        
        <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-slate-50 border-b">
                    <tr>
                        <th class="p-6 text-[10px] font-black text-slate-400 uppercase">Customer</th>
                        <th class="p-6 text-[10px] font-black text-slate-400 uppercase">Items</th>
                        <th class="p-6 text-[10px] font-black text-slate-400 uppercase">Total</th>
                        <th class="p-6 text-[10px] font-black text-slate-400 uppercase">Status</th>
                        <th class="p-6 text-[10px] font-black text-slate-400 uppercase text-right">Action</th>
                    </tr>
                </thead>
                <tbody id="orderTableBody" class="divide-y divide-slate-50">
                    </tbody>
            </table>
        </div>
    </main>

    <script>
        async function loadOrders() {
            try {
                const response = await fetch('http://localhost:5000/api/orders/all');
                const orders = await response.json();
                const table = document.getElementById('orderTableBody');
                table.innerHTML = "";

                orders.forEach(order => {
                    const statusColor = order.status === 'Pending' ? 'bg-orange-100 text-orange-600' : 'bg-green-100 text-green-600';
                    
                    table.innerHTML += `
                        <tr class="hover:bg-slate-50 transition">
                            <td class="p-6">
                                <p class="font-bold text-slate-800">${order.customerName}</p>
                                <p class="text-[10px] text-slate-400">${order.phone}</p>
                            </td>
                            <td class="p-6 text-sm text-slate-500">
                                ${order.items.map(i => `${i.name} (x1)`).join(', ')}
                            </td>
                            <td class="p-6 font-black text-blue-900">â‚¹${order.totalAmount.toLocaleString()}</td>
                            <td class="p-6">
                                <span class="${statusColor} text-[10px] font-black px-3 py-1 rounded-full uppercase">${order.status}</span>
                            </td>
                            <td class="p-6 text-right">
                                <button onclick="updateStatus('${order._id}', 'Shipped')" class="text-blue-600 hover:underline text-xs font-bold">Mark Shipped</button>
                            </td>
                        </tr>`;
                });
            } catch (err) { console.error(err); }
        }

        async function updateStatus(id, newStatus) {
            await fetch(`http://localhost:5000/api/orders/status/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: newStatus })
            });
            loadOrders();
        }

        document.addEventListener('DOMContentLoaded', loadOrders);
    </script>
</body>
</html>