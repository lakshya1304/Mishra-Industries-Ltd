<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Product Details | Mishra Industries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body class="bg-gray-50 p-6 md:p-20">
    <div
      id="detailsContainer"
      class="max-w-6xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row"
    >
      <div class="md:w-1/2 bg-slate-100 p-12 flex items-center justify-center">
        <img
          id="pImg"
          src=""
          class="max-h-[500px] object-contain transition-transform hover:scale-110 duration-500"
        />
      </div>
      <div class="md:w-1/2 p-12 flex flex-col justify-center">
        <p
          id="pCat"
          class="text-orange-500 font-black uppercase tracking-widest mb-2"
        ></p>
        <h1
          id="pName"
          class="text-4xl font-black text-blue-900 mb-6 uppercase"
        ></h1>
        <p id="pDesc" class="text-gray-500 leading-relaxed mb-8 text-lg"></p>

        <div class="flex items-center space-x-6 mb-10">
          <span id="pPrice" class="text-4xl font-black text-blue-900"></span>
          <span
            id="pDiscount"
            class="bg-orange-500 text-white px-3 py-1 rounded-full text-xs font-bold animate-pulse"
          ></span>
        </div>

        <button
          id="addBtn"
          class="w-full bg-blue-900 text-white py-5 rounded-2xl font-black uppercase tracking-widest hover:bg-orange-500 transition shadow-xl flex items-center justify-center"
        >
          <i class="fas fa-cart-plus mr-3"></i> Add to Mishra Cart
        </button>
      </div>
    </div>

    <script>
      async function loadProductDetails() {
        // 1. Get ID from the URL (?id=...)
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get("id");

        if (!productId) return (window.location.href = "shop.html");

        try {
          // 2. Fetch specific product from your backend
          const response = await fetch(
            `http://localhost:5000/api/products/${productId}`,
          );
          const product = await response.json();

          // 3. Update the Page
          document.getElementById("pName").innerText = product.name;
          document.getElementById("pDesc").innerText = product.description;
          document.getElementById("pCat").innerText = product.category;
          document.getElementById("pPrice").innerText =
            `â‚¹${product.price.toLocaleString()}`;
          document.getElementById("pImg").src =
            `http://localhost:5000${product.image}`;

          if (product.discount > 0) {
            document.getElementById("pDiscount").innerText =
              `${product.discount}% OFF`;
          } else {
            document.getElementById("pDiscount").style.display = "none";
          }

          // 4. Set up Add to Cart button
          document.getElementById("addBtn").onclick = () => {
            // This reuses your existing addToCart logic
            const cart = JSON.parse(localStorage.getItem("Mishra_Cart")) || [];
            cart.push({ name: product.name, price: product.price });
            localStorage.setItem("Mishra_Cart", JSON.stringify(cart));
            alert("Added to Cart!");
          };
        } catch (err) {
          console.error("Failed to load details", err);
        }
      }
      loadProductDetails();
    </script>
  </body>
</html>
